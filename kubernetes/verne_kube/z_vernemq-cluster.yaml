apiVersion: vernemq.com/v1alpha1
kind: VerneMQ
metadata:
  labels:
    vernemq: k8s
  name: k8s
spec:
  baseImage: mprevide/verne
  env:
    - name: STATIC_CERT
      value: "n"
    - name: K8S_ENV
      value: "y"
    - name: CERT_EJBCA_API_BROKER
      value: "ejbca-simple"
    - name: CERT_EJBCA_API_PORT
      value: "5583"
    - name: CRL_UPDATE_TIME
      value: "*/30 * * * *" #every 30 min
    - name: CHECK_EXPIRATION_TIME
      value: "*/30 * * * *" #every 30 min
    - name: CHECKEND_EXPIRATION_SEC
      value: "43200" #12h 
    - name: CERT_DNS
      value: "10.50.11.235"
    ## BASE-64 config
    - name: VERNEMQ_CONF
      value: "YWNjZXB0X2V1bGEgPSB5ZXMKbWV0YWRhdGFfcGx1Z2luID0gdm1xX3N3YwpsaXN0ZW5lci52bXEuY2x1c3RlcmluZyA9ICRNWV9QT0RfSVA6NDQwNTMKbGlzdGVuZXIuaHR0cC5kZWZhdWx0ID0gMC4wLjAuMDo4ODg4CnBsdWdpbnMudm1xX3Bhc3N3ZCA9IG9mZgpwbHVnaW5zLnZtcV9hY2wgPSBvbgpwbHVnaW5zLnZtcV9rOHMucGF0aCA9IC92ZXJuZW1xL3BsdWdpbnMvX2J1aWxkL2RlZmF1bHQKcGx1Z2lucy52bXFfazhzID0gb24KbGV2ZWxkYi5tYXhpbXVtX21lbW9yeS5wZXJjZW50ID0gMjAKbG9nLmNvbnNvbGUgPSBjb25zb2xlCnBsdWdpbnMudm1xX3dlYmhvb2tzPW9uCnZtcV93ZWJob29rcy5kb2pvdF9yZWdpc3Rlci5ob29rID0gYXV0aF9vbl9yZWdpc3Rlcgp2bXFfd2ViaG9va3MuZG9qb3RfcmVnaXN0ZXIuZW5kcG9pbnQgPSBodHRwOi8vd2ViaG9vay12ZXJuZTo0MDAwL3JlZwp2bXFfd2ViaG9va3MuZG9qb3RfcHVibGlzaC5ob29rID0gYXV0aF9vbl9wdWJsaXNoCnZtcV93ZWJob29rcy5kb2pvdF9wdWJsaXNoLmVuZHBvaW50ID0gaHR0cDovL3dlYmhvb2stdmVybmU6NDAwMC9wdWIKdm1xX3dlYmhvb2tzLmRvam90X3N1YnNjcmliZS5ob29rID0gYXV0aF9vbl9zdWJzY3JpYmUKdm1xX3dlYmhvb2tzLmRvam90X3N1YnNjcmliZS5lbmRwb2ludCA9IGh0dHA6Ly93ZWJob29rLXZlcm5lOjQwMDAvc3ViCmxpc3RlbmVyLm1heF9jb25uZWN0aW9ucyA9IDIwMDAwMApsaXN0ZW5lci5ucl9vZl9hY2NlcHRvcnMgPSAxMDAKbWF4X2luZmxpZ2h0X21lc3NhZ2VzID0gMjAKbWF4X29ubGluZV9tZXNzYWdlcyA9IDEwMDAwCmxpc3RlbmVyLnNzbC5kZWZhdWx0ID0gMC4wLjAuMDo4ODgzCmxpc3RlbmVyLnNzbC5kZWZhdWx0LmNhZmlsZSA9ICAvdmVybmVtcS9jZXJ0L2NhLmNydApsaXN0ZW5lci5zc2wuZGVmYXVsdC5jZXJ0ZmlsZSA9IC92ZXJuZW1xL2NlcnQvJEhPU1ROQU1FLmNydApsaXN0ZW5lci5zc2wuZGVmYXVsdC5rZXlmaWxlID0gL3Zlcm5lbXEvY2VydC8kSE9TVE5BTUUua2V5Cmxpc3RlbmVyLnNzbC5kZWZhdWx0LmNybGZpbGUgPSAgL3Zlcm5lbXEvY2VydC9jYS5jcmwKbGlzdGVuZXIuc3NsLmRlZmF1bHQudXNlX2lkZW50aXR5X2FzX3VzZXJuYW1lID0gb2ZmCmxpc3RlbmVyLnNzbC5kZWZhdWx0LnJlcXVpcmVfY2VydGlmaWNhdGUgPSBvbg=="
  config:
    configs:
    - name: allow_register_during_netsplit
      value: "on"
    - name: allow_publish_during_netsplit
      value: "on"
    - name: allow_subscribe_during_netsplit
      value: "on"
    - name: allow_unsubscribe_during_netsplit
      value: "on"
    listeners:
    - address: 0.0.0.0
      port: 1883
    - address: 0.0.0.0
      port: 1888
      websocket: true
    plugins: []
  serviceAccountName: vernemq-k8s
  size: 1
  tag: latest
